# TOP K 问题

## 问题1

一个内存有限的机器，假设为 4G，我们有一个文件是 6G，该如何从这个 6G 的文件中找到最大的 ip

## Top K 单机思路（分治法）

### 1.大文件分成小文件

根据文件内容去进行 hash 或者分离，将单个文件分割成尽量均匀的多个文件。

### 2.对每个小文件进行统计并合并

对每个小文件使用堆排序或者快速排序等方式处理取得频次最高的 ip

#### 排序方法：

1.快速排序，取出 k 个

2.局部排序，冒泡法

3.堆排序，只找到 topk 但是不排序

4.快速排序在优化：分治法+二分，判断枢纽是否是 k

### 3.对小文件的统计结果，再做依次统计，求出出现频率最高的那个数字



## 问题2

1亿个搜索关键词找出次数最多的前100个搜索词（考虑内存空间限制）？ 

### 哈希+分治+归并

#### 哈希算法

第一次遍历将关键词散列到不同的文件中（散列算法是性能关键，哈希函数的性能直接影响散列的结果， 尽量避免“***\*数据倾斜\****”）， `同一个关键词一定会散列到同一个文件`， 理想情况是所有关键词均匀散列到不同的文件中（即**分治**思想，将大文件分解为小问题）。

#### 分治

读取每个文件并记录各关键词的次数， 做个冒泡排序， 从每个文件中排序出前100的关键词；

#### 合并

  取第一个文件的记录结果， 和第二个文件做“**合并**”， 即200个结果中排序出前100个关键词， 然后依次合并第三个、第四个。。。。第N个文件(将子结果合并为总结果)。

